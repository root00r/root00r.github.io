
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">

<meta name="DC.Title" content="MPLS LDP报文格式">
<meta name="DC.Relation" scheme="URI" content="../message/application-layer.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="rrpp_message_format_3">
<meta name="DC.Language" content="zh-cn">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<title>MPLS LDP报文格式</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="rrpp_message_format_3"></a><a name="rrpp_message_format_3"></a>


<h1 class="topictitle1">MPLS LDP报文格式</h1>

<div>
<div class="section"><h4 class="sectiontitle">LDP消息头部格式</h4><p>为保证LDP消息的可靠发送，除了Discovery（Hello）消息使用UDP（端口646）外，LDP的Session消息、Advertisement消息和Notification消息都使用TCP（端口646）传输。</p>
<p>LDP协议消息头部格式如下（PDU，协议数据单元，每个LDP PDU有个LDP消息头，后面跟着一个或多个LDP消息内容）。</p>
<div class="fignone"><span class="figcap"><b>图1 </b>LDP协议消息头部格式</span>

<br><span><img src="image/ldp-format.png"></span></div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="8.401084010840108%" id="mcps1.2.1.5.1.4.1.1">字段</th>

<th class="cellrowborder" valign="top" width="6.233062330623307%" id="mcps1.2.1.5.1.4.1.2">长度</th>

<th class="cellrowborder" valign="top" width="85.36585365853658%" id="mcps1.2.1.5.1.4.1.3">说明</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="8.401084010840108%" headers="mcps1.2.1.5.1.4.1.1 ">Version</td>

<td class="cellrowborder" valign="top" width="6.233062330623307%" headers="mcps1.2.1.5.1.4.1.2 ">2字节</td>

<td class="cellrowborder" valign="top" width="85.36585365853658%" headers="mcps1.2.1.5.1.4.1.3 ">表示版本号。目前LDP的版本号始终为1。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840108%" headers="mcps1.2.1.5.1.4.1.1 ">PDU Length</td>

<td class="cellrowborder" valign="top" width="6.233062330623307%" headers="mcps1.2.1.5.1.4.1.2 ">2字节</td>

<td class="cellrowborder" valign="top" width="85.36585365853658%" headers="mcps1.2.1.5.1.4.1.3 "><p>表示PDU的总长度，包括LDP ID和整组LDP消息，不包括Version和PDU Length字段。</p>
<p>例如某个LDP报文中包含3个Hello消息，则该报文的PDU length = 3 * Message length。</p>
</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840108%" headers="mcps1.2.1.5.1.4.1.1 ">LSR-ID</td>

<td class="cellrowborder" valign="top" width="6.233062330623307%" headers="mcps1.2.1.5.1.4.1.2 ">4字节</td>

<td class="cellrowborder" valign="top" width="85.36585365853658%" headers="mcps1.2.1.5.1.4.1.3 ">LDR-ID标识一台LSR，必须全局唯一。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840108%" headers="mcps1.2.1.5.1.4.1.1 ">LaberSpace ID</td>

<td class="cellrowborder" valign="top" width="6.233062330623307%" headers="mcps1.2.1.5.1.4.1.2 ">2字节</td>

<td class="cellrowborder" valign="top" width="85.36585365853658%" headers="mcps1.2.1.5.1.4.1.3 ">标识了LSR内的标签空间。对于平台范围标签空间，这些数值都应当为0。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840108%" headers="mcps1.2.1.5.1.4.1.1 ">Bunch of messages</td>

<td class="cellrowborder" valign="top" width="6.233062330623307%" headers="mcps1.2.1.5.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="85.36585365853658%" headers="mcps1.2.1.5.1.4.1.3 ">是一组LDP消息的集合，可以是一个或者多个LDP消息。<ul><li>当LDP报文以UDP方式传输时，“Bunch of messages”只能是Hello消息的集合。</li><li>当LDP报文以TCP方式传输时，“Bunch of messages”可以是除Hello消息外任意类型的LDP消息的集合。</li></ul>
</td>

</tr>

</tbody>

</table>
</div>
</div>

<div class="section"><h4 class="sectiontitle">LDP消息格式</h4><p>所有LDP消息的格式如下：</p>
<div class="fignone"><span class="figcap"><b>图2 </b>LDP消息格式</span>

<br><span><img src="image/ldp-format-ldp-message.png"></span></div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="8.401084010840107%" id="mcps1.2.2.4.1.4.1.1">字段</th>

<th class="cellrowborder" valign="top" width="13.821138211382111%" id="mcps1.2.2.4.1.4.1.2">长度</th>

<th class="cellrowborder" valign="top" width="77.77777777777777%" id="mcps1.2.2.4.1.4.1.3">说明</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.2.4.1.4.1.1 ">U</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.2.4.1.4.1.2 ">1比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.2.4.1.4.1.3 "><p>未知的消息。</p>
<ul><li>如果对端收到的LDP消息中“Message type”字段为未知的LDP消息类型，且“U”字段的值为“0”，则向源端发送通知（Notification）消息。 </li><li>如果对端收到的LDP消息中“Message type”字段为未知的LDP消息类型，且“U”字段的值为“1”，则忽略该未知消息。 </li></ul>
</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.2.4.1.4.1.1 ">Message Type</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.2.4.1.4.1.2 ">15比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.2.4.1.4.1.3 ">LDP消息的类型。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.2.4.1.4.1.1 ">Message Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.2.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.2.4.1.4.1.3 ">LDP消息的长度，是Message ID、强制参数和可选参数的长度的总和。</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.2.4.1.4.1.1 ">Message ID</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.2.4.1.4.1.2 ">32比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.2.4.1.4.1.3 ">LDP消息的编号，用于唯一地标识一个LDP消息。</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.2.4.1.4.1.1 ">Mandatory Parameters</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.2.4.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.2.4.1.4.1.3 ">LDP消息的强制参数。</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.2.4.1.4.1.1 ">Optional Parameters</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.2.4.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.2.4.1.4.1.3 ">LDP消息的可选参数，包含0~n个TLV。</td>

</tr>

</tbody>

</table>
</div>
</div>

<div class="section"><h4 class="sectiontitle">通告（Notification）消息</h4><p>LSR发送通告消息来通知重要事件到LDP对等体。通告消息通知致命错误或提供咨询信息，如处理LDP消息的结果或LDP会话的状态。</p>
<div class="fignone"><span class="figcap"><b>图3 </b>Notification消息格式</span>

<br><span><img src="image/ldp-format-Notification.png"></span></div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="8.401084010840107%" id="mcps1.2.3.4.1.4.1.1">字段</th>

<th class="cellrowborder" valign="top" width="13.821138211382111%" id="mcps1.2.3.4.1.4.1.2">长度</th>

<th class="cellrowborder" valign="top" width="77.77777777777777%" id="mcps1.2.3.4.1.4.1.3">说明</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.3.4.1.4.1.1 ">Message Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.3.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.3.4.1.4.1.3 ">LDP消息的长度，是Message ID、强制参数和可选参数的长度的总和。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.3.4.1.4.1.1 ">Message ID</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.3.4.1.4.1.2 ">32比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.3.4.1.4.1.3 ">LDP消息的编号，用于唯一地标识一个LDP消息。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.3.4.1.4.1.1 ">Status TLV</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.3.4.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.3.4.1.4.1.3 ">标识一个事件。</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.3.4.1.4.1.1 ">Optional Parameters</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.3.4.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.3.4.1.4.1.3 ">可选参数，包含0~n个TLV。</td>

</tr>

</tbody>

</table>
</div>
</div>

<div class="section"><h4 class="sectiontitle">Hello消息</h4><p>用于通告和维护网络中LSR的存在。</p>
<div class="fignone"><span class="figcap"><b>图4 </b>Hello消息格式</span>

<br><span><img src="image/ldp-format-Hello.png"></span></div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="8.401084010840107%" id="mcps1.2.4.4.1.4.1.1">字段</th>

<th class="cellrowborder" valign="top" width="13.821138211382111%" id="mcps1.2.4.4.1.4.1.2">长度</th>

<th class="cellrowborder" valign="top" width="77.77777777777777%" id="mcps1.2.4.4.1.4.1.3">说明</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.4.4.1.4.1.1 ">Message Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.4.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.4.4.1.4.1.3 ">LDP消息的长度，是Message ID、强制参数和可选参数的长度的总和。 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.4.4.1.4.1.1 ">Message ID</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.4.4.1.4.1.2 ">32比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.4.4.1.4.1.3 ">LDP消息的编号，用于唯一地标识一个LDP消息。</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.4.4.1.4.1.1 ">Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.4.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.4.4.1.4.1.3 ">LDP消息是以LDP PDU中的TLV形式定义的. 每个LDP TLV有一个2字节的Type域，2字节的Length域和变长的Value域。这里的Length就表示TLV的Value域的字节数。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.4.4.1.4.1.1 ">Hold Time</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.4.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.4.4.1.4.1.3 ">保持时间，以秒为单位的Hello保持时间。LSR维护来自潜在同伴的Hello的记录。为0的数值意味着使用缺省值。0xffff的数值意味着无穷大。 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.4.4.1.4.1.1 ">T</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.4.4.1.4.1.2 ">1比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.4.4.1.4.1.3 ">T（Targeted Hello）值为1表示为远端Hello消息，值为0表示本地Hello消息。</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.4.4.1.4.1.1 ">R</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.4.4.1.4.1.2 ">1比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.4.4.1.4.1.3 ">R（Request Send Targeted Hellos）值为1表示请求接收者周期性发送远端Hello消息给该Hello的发送源端，值为0表示没有此需求。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.4.4.1.4.1.1 ">Reserved</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.4.4.1.4.1.2 ">14比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.4.4.1.4.1.3 ">保留字段，必须置0，接收端忽略此字段。</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.4.4.1.4.1.1 ">Optional Parameters</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.4.4.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.4.4.1.4.1.3 ">可选参数，包含0~n个TLV。</td>

</tr>

</tbody>

</table>
</div>
</div>

<div class="section"><h4 class="sectiontitle">Initialization消息</h4><p>LDP的Initialization消息在LDP回家建立阶段发送，格式如下：</p>
<div class="fignone"><span class="figcap"><b>图5 </b>Initialization消息格式</span>

<br><span><img src="image/ldp-format-Initialization.png"></span></div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="8.401084010840107%" id="mcps1.2.5.4.1.4.1.1">字段</th>

<th class="cellrowborder" valign="top" width="13.821138211382111%" id="mcps1.2.5.4.1.4.1.2">长度</th>

<th class="cellrowborder" valign="top" width="77.77777777777777%" id="mcps1.2.5.4.1.4.1.3">说明</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.5.4.1.4.1.1 ">Message Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.5.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.5.4.1.4.1.3 ">LDP消息的长度，是Message ID、强制参数和可选参数的长度的总和。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.5.4.1.4.1.1 ">Message ID</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.5.4.1.4.1.2 ">32比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.5.4.1.4.1.3 ">LDP消息的编号，用于唯一地标识一个LDP消息。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.5.4.1.4.1.1 ">Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.5.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.5.4.1.4.1.3 ">LDP消息是以LDP PDU中的TLV形式定义的. 每个LDP TLV有一个2字节的Type域，2字节的Length域和变长的Value域。这里的Length就表示TLV的Value域的字节数。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.5.4.1.4.1.1 ">Protocol Version</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.5.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.5.4.1.4.1.3 ">表示协议版本号 = 1。</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.5.4.1.4.1.1 ">KeepAlive Time</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.5.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.5.4.1.4.1.3 ">TCP连接的保持时间，这个定时器的刷新并不是收到KeepAlive消息才会刷新，而是通过TCP连接收到的LDP PDU时都会刷新</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.5.4.1.4.1.1 ">A</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.5.4.1.4.1.2 ">1比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.5.4.1.4.1.3 ">表明标签分配方式 ( 0 = DU ；1 = DoD)</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.5.4.1.4.1.1 ">D</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.5.4.1.4.1.2 ">1比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.5.4.1.4.1.3 ">表明是否使能了环路检测功能(0 = Disable ; 1 = Enable)。 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.5.4.1.4.1.1 ">Reserved</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.5.4.1.4.1.2 ">6比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.5.4.1.4.1.3 ">保留字段，必须置0，接收端忽略此字段。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.5.4.1.4.1.1 ">PVLim</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.5.4.1.4.1.2 ">8比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.5.4.1.4.1.3 ">PVLim (Path Vector Limit)，LSP支持的最大跳数(只有在使能了Loop detection功能时有效，默认值为32)。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.5.4.1.4.1.1 ">Max PDU Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.5.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.5.4.1.4.1.3 ">LDP PDU的最大长度，默认值为4096字节。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.5.4.1.4.1.1 ">Receiver LDP Identifier</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.5.4.1.4.1.2 ">6字节</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.5.4.1.4.1.3 ">Initialization消息的接收者的LDP标识符(LDP ID)。</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.5.4.1.4.1.1 ">Optional Parameters</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.5.4.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.5.4.1.4.1.3 ">可选参数，包含0~n个TLV。</td>

</tr>

</tbody>

</table>
</div>
</div>

<div class="section"><h4 class="sectiontitle">KeepAlive消息</h4><p>Keepalive消息无Mandatory Parameters字段及后面的字段，用于维护SESSION的状态，所以这里不需要什么特别的内容，只要对方知道自己还存在就好。</p>
<div class="fignone"><span class="figcap"><b>图6 </b>KeepAlive消息格式</span>

<br><span><img src="image/ldp-format-KeepAlive.png"></span></div>
</div>

<div class="section"><h4 class="sectiontitle">地址（Address）消息</h4><p>Address消息用于LSR发送地址消息到LDP邻居，以公告其接口地址。 </p>
<div class="fignone"><span class="figcap"><b>图7 </b>Address消息格式</span>

<br><span><img src="image/ldp-format-Address.png"></span></div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="8.401084010840107%" id="mcps1.2.7.4.1.4.1.1">字段</th>

<th class="cellrowborder" valign="top" width="13.821138211382111%" id="mcps1.2.7.4.1.4.1.2">长度</th>

<th class="cellrowborder" valign="top" width="77.77777777777777%" id="mcps1.2.7.4.1.4.1.3">说明</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.7.4.1.4.1.1 ">Message Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.7.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.7.4.1.4.1.3 ">LDP消息的长度，是Message ID、强制参数和可选参数的长度的总和。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.7.4.1.4.1.1 ">Message ID</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.7.4.1.4.1.2 ">32比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.7.4.1.4.1.3 ">LDP消息的编号，用于唯一地标识一个LDP消息。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.7.4.1.4.1.1 ">Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.7.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.7.4.1.4.1.3 ">LDP消息是以LDP PDU中的TLV形式定义的. 每个LDP TLV有一个2字节的Type域，2字节的Length域和变长的Value域。这里的Length就表示TLV的Value域的字节数。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.7.4.1.4.1.1 ">Address Family</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.7.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.7.4.1.4.1.3 ">地址族编号。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.7.4.1.4.1.1 ">Addresses</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.7.4.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.7.4.1.4.1.3 ">指定地址族的地址列表，格式取决于地址族类型：<ul><li>IPv4地址为4字节</li><li>IPv6地址为16字节</li></ul>
</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.7.4.1.4.1.1 ">Optional Parameters</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.7.4.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.7.4.1.4.1.3 ">可选参数，包含0~n个TLV。</td>

</tr>

</tbody>

</table>
</div>
</div>

<div class="section"><h4 class="sectiontitle">地址撤销（Address Withdraw）消息</h4><p>LSR发送Address Withdraw消息到LDP对等体，以撤销之前公告的接口地址。当接口地址被删除或接口down后，就会发送Address
Withdraw消息。</p>
<div class="fignone"><span class="figcap"><b>图8 </b>Address Withdraw消息格式</span>

<br><span><img src="image/ldp-format-AddressWithdraw.png"></span></div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="8.401084010840107%" id="mcps1.2.8.4.1.4.1.1">字段</th>

<th class="cellrowborder" valign="top" width="13.821138211382111%" id="mcps1.2.8.4.1.4.1.2">长度</th>

<th class="cellrowborder" valign="top" width="77.77777777777777%" id="mcps1.2.8.4.1.4.1.3">说明</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.8.4.1.4.1.1 ">Message Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.8.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.8.4.1.4.1.3 ">LDP消息的长度，是Message ID、强制参数和可选参数的长度的总和。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.8.4.1.4.1.1 ">Message ID</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.8.4.1.4.1.2 ">32比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.8.4.1.4.1.3 ">LDP消息的编号，用于唯一地标识一个LDP消息。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.8.4.1.4.1.1 ">Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.8.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.8.4.1.4.1.3 ">LDP消息是以LDP PDU中的TLV形式定义的. 每个LDP TLV有一个2字节的Type域，2字节的Length域和变长的Value域。这里的Length就表示TLV的Value域的字节数。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.8.4.1.4.1.1 ">Address Family</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.8.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.8.4.1.4.1.3 ">地址族编号。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.8.4.1.4.1.1 ">Addresses</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.8.4.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.8.4.1.4.1.3 ">指定地址族的地址列表，格式取决于地址族类型：<ul><li>IPv4地址为4字节</li><li>IPv6地址为16字节</li></ul>
</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.8.4.1.4.1.1 ">Optional Parameters</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.8.4.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.8.4.1.4.1.3 ">可选参数，包含0~n个TLV。</td>

</tr>

</tbody>

</table>
</div>
</div>

<div class="section"><h4 class="sectiontitle">Label Mapping消息</h4><p>对于特定的FEC，下游使用Label Mapping消息为上游分配标签。</p>
<p>Label Mapping消息均由下游发往上游节点，Label Mapping消息的发送方式因标签分配方式或者标签控制方式的不同而不同：</p>
<ul><li>DU模式下：下游无需等待上游的Label Request消息可以直接为某FEC向上游LDP邻居发送Label Mapping消息；</li><li>DoD模式下：下游必须等待上游的Label Request消息才能为指定的FEC向上游LDP邻居发送Label Mapping消息；</li><li>Independent模式下：中间节点无需等待收到下游为指定FEC发送的Label Mapping消息后才向它的上游LDP邻居发送Label
Mapping消息；</li><li>Order模式下：中间节点必须等待收到下游为指定FEC发送的Label Mapping消息后才能向它的上游LDP邻居发送Label
Mapping消息。</li></ul>
<div class="fignone"><span class="figcap"><b>图9 </b>Label Mapping消息格式</span>

<br><span><img src="image/ldp-format-Label-Mapping.png"></span></div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="8.401084010840107%" id="mcps1.2.9.6.1.4.1.1">字段</th>

<th class="cellrowborder" valign="top" width="13.821138211382111%" id="mcps1.2.9.6.1.4.1.2">长度</th>

<th class="cellrowborder" valign="top" width="77.77777777777777%" id="mcps1.2.9.6.1.4.1.3">说明</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.9.6.1.4.1.1 ">Message Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.9.6.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.9.6.1.4.1.3 ">LDP消息的长度，是Message ID、强制参数和可选参数的长度的总和。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.9.6.1.4.1.1 ">Message ID</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.9.6.1.4.1.2 ">32比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.9.6.1.4.1.3 ">LDP消息的编号，用于唯一地标识一个LDP消息。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.9.6.1.4.1.1 ">Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.9.6.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.9.6.1.4.1.3 ">LDP消息是以LDP PDU中的TLV形式定义的. 每个LDP TLV有一个2字节的Type域，2字节的Length域和变长的Value域。这里的Length就表示TLV的Value域的字节数。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.9.6.1.4.1.1 ">FEC Element 1 to FEC Element n</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.9.6.1.4.1.2 ">每个Element 1字节</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.9.6.1.4.1.3 "><p>表明该标签是为哪个FEC而分配的。</p>
<p>FEC Element的格式定义：</p>
<ul><li>Type = 0x01: 反掩码。只在Label Withdraw和Label Release消息中使用。</li><li><p>Type = 0x02: 前缀。</p>
<p>格式如下：</p>
<div class="fignone"><span class="figcap"><b>图10 </b>前缀FEC Element的格式</span>

<br><span><img src="image/ldp-format-FEC.png"></span></div>
</li></ul>
</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.9.6.1.4.1.1 ">Label TLV</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.9.6.1.4.1.2 ">52比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.9.6.1.4.1.3 "><p>表明下游为该FEC分配了什么标签。</p>
<div class="fignone"><span class="figcap"><b>图11 </b>Label TLV的格式</span>

<br><span><img src="image/ldp-format-label-tlv.png"></span></div>
<p>Label字段是个20比特的标签值。</p>
</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.9.6.1.4.1.1 ">Optional Parameters</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.9.6.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.9.6.1.4.1.3 ">可选参数，包含0~n个TLV。</td>

</tr>

</tbody>

</table>
</div>
</div>

<div class="section"><h4 class="sectiontitle">Label Request消息</h4><p>LSR发送Label Request消息给LDP对等体请求FEC对应的标签。</p>
<p>Label Request消息只能由作为Ingress的LSR发起，不能由作为Transit的LSR发起（Order＋dod）。下游收到Label
Request消息后需要向上游返回Label Mapping消息，Label Mapping消息中携带Label Request消息中的Message
ID TLV。</p>
<p>下列情况下，下游收到Label Request消息后不会向上游返回Label Mapping消息：</p>
<ul><li>下游找不到与Label Request中FEC TLV中对应的路由，此时返回No Route的Notification消息；</li><li>下游没有足够的标签来分配，此时返回No Label Resource的Notification消息；</li><li>下游检测到有环路发生，此时返回Loop Detected的Notification消息。</li></ul>
<div class="fignone"><span class="figcap"><b>图12 </b>Label Request消息格式</span>

<br><span><img src="image/ldp-format-Label-Request.png"></span></div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="8.401084010840107%" id="mcps1.2.10.7.1.4.1.1">字段</th>

<th class="cellrowborder" valign="top" width="13.821138211382111%" id="mcps1.2.10.7.1.4.1.2">长度</th>

<th class="cellrowborder" valign="top" width="77.77777777777777%" id="mcps1.2.10.7.1.4.1.3">说明</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.10.7.1.4.1.1 ">Message Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.10.7.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.10.7.1.4.1.3 ">LDP消息的长度，是Message ID、强制参数和可选参数的长度的总和。 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.10.7.1.4.1.1 ">Message ID</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.10.7.1.4.1.2 ">32比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.10.7.1.4.1.3 ">LDP消息的编号，用于唯一地标识一个LDP消息。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.10.7.1.4.1.1 ">Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.10.7.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.10.7.1.4.1.3 ">LDP消息是以LDP PDU中的TLV形式定义的. 每个LDP TLV有一个2字节的Type域，2字节的Length域和变长的Value域。这里的Length就表示TLV的Value域的字节数。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.10.7.1.4.1.1 ">FEC Element 1 to FEC Element n</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.10.7.1.4.1.2 ">每个Element 1字节</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.10.7.1.4.1.3 "><p>表明该标签是为哪个FEC而分配的。</p>
<p>FEC Element的格式定义：</p>
<ul><li>Type = 0x01: 反掩码。只在Label Withdraw和Label Release消息中使用。</li><li><p>Type = 0x02: 前缀。</p>
<p>格式如下：</p>
<div class="fignone"><span class="figcap"><b>图13 </b>前缀FEC Element的格式</span>

<br><span><img src="image/ldp-format-FEC.png"></span></div>
</li></ul>
</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.10.7.1.4.1.1 ">Optional Parameters</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.10.7.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.10.7.1.4.1.3 ">可选参数，包含0~n个TLV。</td>

</tr>

</tbody>

</table>
</div>
</div>

<div class="section"><h4 class="sectiontitle">Label Abort Request消息</h4><p>上游LSR发送了Label Request消息后但还没有收到Label
Mapping消息前，发现FEC对应的下一跳变化了或者其他可能的原因需要发送新的Label Request消息时，上游会向下游发送Label
Abort Request消息。</p>
<div class="fignone"><span class="figcap"><b>图14 </b>Label Abort Request消息格式</span>

<br><span><img src="image/ldp-format-Label-Abort-Request.png"></span></div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="8.401084010840107%" id="mcps1.2.11.4.1.4.1.1">字段</th>

<th class="cellrowborder" valign="top" width="13.821138211382111%" id="mcps1.2.11.4.1.4.1.2">长度</th>

<th class="cellrowborder" valign="top" width="77.77777777777777%" id="mcps1.2.11.4.1.4.1.3">说明</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.11.4.1.4.1.1 ">Message Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.11.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.11.4.1.4.1.3 ">LDP消息的长度，是Message ID、强制参数和可选参数的长度的总和。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.11.4.1.4.1.1 ">Message ID</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.11.4.1.4.1.2 ">32比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.11.4.1.4.1.3 ">LDP消息的编号，用于唯一地标识一个LDP消息。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.11.4.1.4.1.1 ">Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.11.4.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.11.4.1.4.1.3 ">LDP消息是以LDP PDU中的TLV形式定义的. 每个LDP TLV有一个2字节的Type域，2字节的Length域和变长的Value域。这里的Length就表示TLV的Value域的字节数。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.11.4.1.4.1.1 ">FEC Element 1 to FEC Element n</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.11.4.1.4.1.2 ">每个Element 1字节</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.11.4.1.4.1.3 "><p>表明该标签是为哪个FEC而废弃的。</p>
<p>FEC Element的格式定义：</p>
<ul><li>Type = 0x01: 反掩码。只在Label Withdraw和Label Release消息中使用。</li><li><p>Type = 0x02: 前缀。</p>
<div class="fignone"><span class="figcap"><b>图15 </b>前缀FEC Element的格式</span>

<br><span><img src="image/ldp-format-FEC.png"></span></div>
</li></ul>
</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.11.4.1.4.1.1 ">Label Request Message ID TLV</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.11.4.1.4.1.2 ">-</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.11.4.1.4.1.3 ">要被废弃的Label Request消息的消息ID。</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.11.4.1.4.1.1 ">Optional Parameters</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.11.4.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.11.4.1.4.1.3 ">可选参数，包含0~n个TLV。</td>

</tr>

</tbody>

</table>
</div>
</div>

<div class="section"><h4 class="sectiontitle">Label Withdraw消息</h4><p>Label Withdraw消息一般由下游LSR发往上游LSR，通知上游LSR之前通告的与某FEC对应的Label不再使用，上游LSR需要解除Label和FEC的映射关系。</p>
<p>下列情况下会发送Label Withdraw消息：</p>
<ul><li>下游节点不再有某条FEC，如果已经为该FEC发送了Label Mapping消息，则发送Label Withdraw消息；</li><li>下游单方面的决定不再使用标签转发时也会发送Label Withdraw消息。</li></ul>
<div class="fignone"><span class="figcap"><b>图16 </b>Label Withdraw消息格式</span>

<br><span><img src="image/ldp-format-Label-Withdraw.png"></span></div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="8.401084010840107%" id="mcps1.2.12.6.1.4.1.1">字段</th>

<th class="cellrowborder" valign="top" width="13.821138211382111%" id="mcps1.2.12.6.1.4.1.2">长度</th>

<th class="cellrowborder" valign="top" width="77.77777777777777%" id="mcps1.2.12.6.1.4.1.3">说明</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.12.6.1.4.1.1 ">Message Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.12.6.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.12.6.1.4.1.3 ">LDP消息的长度，是Message ID、强制参数和可选参数的长度的总和。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.12.6.1.4.1.1 ">Message ID</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.12.6.1.4.1.2 ">32比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.12.6.1.4.1.3 ">LDP消息的编号，用于唯一地标识一个LDP消息。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.12.6.1.4.1.1 ">Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.12.6.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.12.6.1.4.1.3 ">LDP消息是以LDP PDU中的TLV形式定义的. 每个LDP TLV有一个2字节的Type域，2字节的Length域和变长的Value域。这里的Length就表示TLV的Value域的字节数。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.12.6.1.4.1.1 ">FEC Element 1 to FEC Element n</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.12.6.1.4.1.2 ">每个Element 1字节</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.12.6.1.4.1.3 "><p>表明该标签是为哪个FEC而撤销的。</p>
<p>FEC Element的格式定义：</p>
<ul><li>Type = 0x01: 反掩码。只在Label Withdraw和Label Release消息中使用。</li><li><p>Type = 0x02: 前缀。</p>
<div class="fignone"><span class="figcap"><b>图17 </b>前缀FEC Element的格式</span>

<br><span><img src="image/ldp-format-FEC.png"></span></div>
</li></ul>
</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.12.6.1.4.1.1 ">Label TLV</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.12.6.1.4.1.2 ">52比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.12.6.1.4.1.3 "><p>表明该FEC对应的标签。</p>
<div class="fignone"><span class="figcap"><b>图18 </b>Label TLV的格式</span>

<br><span><img src="image/ldp-format-label-tlv.png"></span></div>
</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.12.6.1.4.1.1 ">Optional Parameters</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.12.6.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.12.6.1.4.1.3 ">可选参数，包含0~n个TLV。</td>

</tr>

</tbody>

</table>
</div>
</div>

<div class="section"><h4 class="sectiontitle">Label Release消息</h4><p>Label Release消息一般由上游发往下游，通知撤销Label和FEC的邦定，该消息相当于Label
Request消息的逆过程。</p>
<p>在下列情况下会发送Label Release消息：</p>
<ul><li>上游LSR的标签保持方式是保守方式，发送Label Mapping消息的LSR不再是FEC的下一跳时，上游LSR需要发送Label
Release消息来撤销Label和FEC的映射关系；</li><li>上游LSR的标签保持方式是保守方式，从不是FEC的下一跳收到Label Mapping消息后，上游LSR需要发送Label
Release消息；</li><li>LSR收到Label Withdraw消息后需要发送Label Release消息。</li></ul>
<div class="fignone"><span class="figcap"><b>图19 </b>Label Release消息格式</span>

<br><span><img src="image/ldp-format-Label-Release.png"></span></div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="8.401084010840107%" id="mcps1.2.13.6.1.4.1.1">字段</th>

<th class="cellrowborder" valign="top" width="13.821138211382111%" id="mcps1.2.13.6.1.4.1.2">长度</th>

<th class="cellrowborder" valign="top" width="77.77777777777777%" id="mcps1.2.13.6.1.4.1.3">说明</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.13.6.1.4.1.1 ">Message Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.13.6.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.13.6.1.4.1.3 ">LDP消息的长度，是Message ID、强制参数和可选参数的长度的总和。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.13.6.1.4.1.1 ">Message ID</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.13.6.1.4.1.2 ">32比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.13.6.1.4.1.3 ">LDP消息的编号，用于唯一地标识一个LDP消息。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.13.6.1.4.1.1 ">Length</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.13.6.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.13.6.1.4.1.3 ">LDP消息是以LDP PDU中的TLV形式定义的. 每个LDP TLV有一个2字节的Type域，2字节的Length域和变长的Value域。这里的Length就表示TLV的Value域的字节数。 </td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.13.6.1.4.1.1 ">FEC Element 1 to FEC Element n</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.13.6.1.4.1.2 ">每个Element 1字节</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.13.6.1.4.1.3 "><p>表明该标签对应的FEC。</p>
<p>FEC Element的格式定义：</p>
<ul><li>Type = 0x01: 反掩码。只在Label Withdraw和Label Release消息中使用。</li><li><p>Type = 0x02: 前缀。</p>
<div class="fignone"><span class="figcap"><b>图20 </b>前缀FEC Element的格式</span>

<br><span><img src="image/ldp-format-FEC.png"></span></div>
</li></ul>
</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.13.6.1.4.1.1 ">Label TLV</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.13.6.1.4.1.2 ">52比特</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.13.6.1.4.1.3 "><div class="fignone"><span class="figcap"><b>图21 </b>Label TLV的格式</span>

<br><span><img src="image/ldp-format-label-tlv.png"></span></div>
</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="8.401084010840107%" headers="mcps1.2.13.6.1.4.1.1 ">Optional Parameters</td>

<td class="cellrowborder" valign="top" width="13.821138211382111%" headers="mcps1.2.13.6.1.4.1.2 ">变长</td>

<td class="cellrowborder" valign="top" width="77.77777777777777%" headers="mcps1.2.13.6.1.4.1.3 ">可选参数，包含0~n个TLV。</td>

</tr>

</tbody>

</table>
</div>
</div>

<div class="section"><h4 class="sectiontitle">LDP消息示例</h4><div class="fignone"><span class="figcap"><b>图22 </b>LDP Hello消息</span>

<br><span><img src="image/LDP-example-hello-remote.png"></span></div>
<div class="fignone"><span class="figcap"><b>图23 </b>LDP KeepAlive消息</span>

<br><span><img src="image/LDP-example-keepalive.png"></span></div>
</div>

<div class="section"><h4 class="sectiontitle">参考标准</h4>
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="50%" id="mcps1.2.15.2.1.3.1.1">标准</th>

<th class="cellrowborder" valign="top" width="50%" id="mcps1.2.15.2.1.3.1.2">描述</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.15.2.1.3.1.1 ">RFC 5036</td>

<td class="cellrowborder" valign="top" width="50%" headers="mcps1.2.15.2.1.3.1.2 ">LDP Specification</td>

</tr>

</tbody>

</table>
</div>
</div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="application-layer.html">应用层</a></div>
</div>
</div>

<div class="hrcopyright"><hr size="2"></div><div class="hwcopyright">本资料收集于互联网</div><div class="hwcopyright">2016 &copy</div></body>
</html>