
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">

<meta name="DC.Title" content="VRRP报文格式">
<meta name="DC.Relation" scheme="URI" content="../message/network-layer.html">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="udp_message_format_2">
<meta name="DC.Language" content="zh-cn">
<link rel="stylesheet" type="text/css" href="../public_sys-resources/commonltr.css">
<title>VRRP报文格式</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="udp_message_format_2"></a><a name="udp_message_format_2"></a>


<h1 class="topictitle1">VRRP报文格式</h1>

<div>
<div class="section"><h4 class="sectiontitle">报文格式</h4><p>VRRP报文被封装在IP包中。使用专门的VRRP IPv4组播地址。（协议号112，组播地址
224.0.0.18）</p>
<p>IANA分配给VRRP的IP协议号为112（十进制）。</p>
<p>IANA给VRRP分配的IP组播地址为224.0.0.18。这是一个本地范围的多播地址。不论TTL的值是多少，路由器都被禁止转发以此地址为目标地址的报文。</p>
<p>VRRP报文的IP头中，TTL必须为255。当VRRP路由器收到TTL不等于255的VRRP协议报文后，必须丢弃。</p>
<div class="fignone"><span class="figcap"><b>图1 </b>VRRP报文格式</span>

<br><span><img src="image/vrrp-format.png"></span></div>

<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all">
<thead align="left">
<tr>

<th class="cellrowborder" valign="top" width="11%" id="mcps1.2.1.7.1.4.1.1">字段</th>

<th class="cellrowborder" valign="top" width="16.333333333333332%" id="mcps1.2.1.7.1.4.1.2">长度</th>

<th class="cellrowborder" valign="top" width="72.66666666666667%" id="mcps1.2.1.7.1.4.1.3">描述</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="11%" headers="mcps1.2.1.7.1.4.1.1 ">Version</td>

<td class="cellrowborder" valign="top" width="16.333333333333332%" headers="mcps1.2.1.7.1.4.1.2 ">4比特</td>

<td class="cellrowborder" valign="top" width="72.66666666666667%" headers="mcps1.2.1.7.1.4.1.3 ">指VRRP协议版本，本文档定义版本号2。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="11%" headers="mcps1.2.1.7.1.4.1.1 ">Type</td>

<td class="cellrowborder" valign="top" width="16.333333333333332%" headers="mcps1.2.1.7.1.4.1.2 ">4比特</td>

<td class="cellrowborder" valign="top" width="72.66666666666667%" headers="mcps1.2.1.7.1.4.1.3 "><p>定义了VRRP报文的类型。本版本的协议仅定义了一个报文类型：</p>
<p>1：ADVERTISEMENT </p>
<p>带有未知类型的报文必须被丢弃。</p>
</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="11%" headers="mcps1.2.1.7.1.4.1.1 ">Virtual Rtr ID8</td>

<td class="cellrowborder" valign="top" width="16.333333333333332%" headers="mcps1.2.1.7.1.4.1.2 ">8比特</td>

<td class="cellrowborder" valign="top" width="72.66666666666667%" headers="mcps1.2.1.7.1.4.1.3 ">虚拟路由器标识（VRID）字段标识了此报文所报告状态的虚拟路由器。可配置的范围是1--255。没有缺省值。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="11%" headers="mcps1.2.1.7.1.4.1.1 ">Priority</td>

<td class="cellrowborder" valign="top" width="16.333333333333332%" headers="mcps1.2.1.7.1.4.1.2 ">8比特</td>

<td class="cellrowborder" valign="top" width="72.66666666666667%" headers="mcps1.2.1.7.1.4.1.3 "><p>Priority字段申明了发送此报文的VRRP路由器的优先级。值越高优先级越高。该字段为8位无符号整型。</p>
<p>如果VRRP路由器是虚拟路由器地址的IP地址所有者，那么其优先级必须为255。起备用作用的VRRP路由器的优先级必须在1--254之间。缺省的VRRP路由器优先级为100。</p>
<p>优先级值0 用于指示当前虚拟路由器的主路由器停止参与VRRP组。主要用于触发备用路由器快速地迁移到主路由器，而不用等待当前主路由器超时。</p>
</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="11%" headers="mcps1.2.1.7.1.4.1.1 ">Count IP Addrs</td>

<td class="cellrowborder" valign="top" width="16.333333333333332%" headers="mcps1.2.1.7.1.4.1.2 ">8比特</td>

<td class="cellrowborder" valign="top" width="72.66666666666667%" headers="mcps1.2.1.7.1.4.1.3 ">在此VRRP通告中包含的IP地址的数量。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="11%" headers="mcps1.2.1.7.1.4.1.1 ">Auth Type</td>

<td class="cellrowborder" valign="top" width="16.333333333333332%" headers="mcps1.2.1.7.1.4.1.2 ">8比特</td>

<td class="cellrowborder" valign="top" width="72.66666666666667%" headers="mcps1.2.1.7.1.4.1.3 "><p>认证类型字段用于标识要用到的认证方法。在一个虚拟路由器组内认证类型是唯一的。认证类型字段是一个8位无符号整型。如果报文携带未知的认证类型或者该认证类型和本地配置的认证方法不匹配，那么该报文必须被丢弃。</p>
<p>目前定义的认证方法有：</p>
<ul><li><p>0 - No Authentication  不认证</p>
<p>该认证类型表明VRRP协议报文的交换不需要认证。在发送VRRP协议报文时，Authentication
Data 字段将被置为0；而在接收协议报文时，Authentication Data 字段被忽略。</p>
</li><li><p>1 - Reserved      保留</p>
</li><li><p>2 - Reserved      保留</p>
</li></ul>
<div class="note"><span class="notetitle"> 说明： </span><div class="notebody">VRRP的早期版本 定义了一些认证类型[RFC2338]。这些认证类型的定义已经在本文档中被删除，因为根据实际经验表明，这些认证方法并不能提供任何真正的安全保障，并且仅会导致在一个VRRP组内出现多个Master的情况。</div></div>
</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="11%" headers="mcps1.2.1.7.1.4.1.1 ">Adver Int</td>

<td class="cellrowborder" valign="top" width="16.333333333333332%" headers="mcps1.2.1.7.1.4.1.2 ">8比特</td>

<td class="cellrowborder" valign="top" width="72.66666666666667%" headers="mcps1.2.1.7.1.4.1.3 "><p>VRRP通告间隔时间，单位为秒。缺省为1秒。这个字段主要用于错误配置路由器时的故障定位和解决。</p>
</td>

</tr>

<tr>

<td class="cellrowborder" valign="top" width="11%" headers="mcps1.2.1.7.1.4.1.1 ">Checksum</td>

<td class="cellrowborder" valign="top" width="16.333333333333332%" headers="mcps1.2.1.7.1.4.1.2 ">16比特</td>

<td class="cellrowborder" valign="top" width="72.66666666666667%" headers="mcps1.2.1.7.1.4.1.3 "><p>校验和字段用于检测VRRP消息的数据是否出错。</p>
<p>校验和是从version字段开始的整个VRRP消息的1的16位补码和。（RFC1071
描述了校验和的计算细节）。</p>
</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="11%" headers="mcps1.2.1.7.1.4.1.1 ">IP Address</td>

<td class="cellrowborder" valign="top" width="16.333333333333332%" headers="mcps1.2.1.7.1.4.1.2 ">32比特</td>

<td class="cellrowborder" valign="top" width="72.66666666666667%" headers="mcps1.2.1.7.1.4.1.3 ">IP地址字段为虚拟路由器的一个或者多个IP地址。IP地址的数量在"Count IP Addrs"字段中说明。IP地址字段用于错误配置路由器时的故障定位和解决。</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="11%" headers="mcps1.2.1.7.1.4.1.1 ">Authentication Data</td>

<td class="cellrowborder" valign="top" width="16.333333333333332%" headers="mcps1.2.1.7.1.4.1.2 ">32比特</td>

<td class="cellrowborder" valign="top" width="72.66666666666667%" headers="mcps1.2.1.7.1.4.1.3 "><p>认证字符串仅仅用于对RFC2338的向后兼容。在发送VRRP报文时该字段应该被置为0，而在接收VRRP报文时该字段应该被忽略。</p>
</td>

</tr>

</tbody>

</table>
</div>
</div>

<div class="section"><h4 class="sectiontitle">报文示例</h4><span><img src="image/VRRP-example.png"></span></div>

<div class="section"><h4 class="sectiontitle">参考标准</h4>
<div class="tablenoborder"><table cellpadding="4" cellspacing="0" summary="" frame="border" border="1" rules="all">
<thead align="left">
<tr>
<th class="cellrowborder" valign="top" width="18%" id="mcps1.2.3.2.1.3.1.1">标准</th>

<th class="cellrowborder" valign="top" width="82%" id="mcps1.2.3.2.1.3.1.2">描述</th>

</tr>

</thead>

<tbody>
<tr>
<td class="cellrowborder" valign="top" width="18%" headers="mcps1.2.3.2.1.3.1.1 ">RFC 2338</td>

<td class="cellrowborder" valign="top" width="82%" headers="mcps1.2.3.2.1.3.1.2 ">Virtual Router Redundancy Protocol</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="18%" headers="mcps1.2.3.2.1.3.1.1 ">RFC 2787</td>

<td class="cellrowborder" valign="top" width="82%" headers="mcps1.2.3.2.1.3.1.2 ">Definitions of Managed Objects for the Virtual Router Redundancy
Protocol</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="18%" headers="mcps1.2.3.2.1.3.1.1 ">RFC 3768</td>

<td class="cellrowborder" valign="top" width="82%" headers="mcps1.2.3.2.1.3.1.2 ">Virtual Router Redundancy Protocol（version number Two 2004）</td>

</tr>

<tr>
<td class="cellrowborder" valign="top" width="18%" headers="mcps1.2.3.2.1.3.1.1 ">RFC 5798</td>

<td class="cellrowborder" valign="top" width="82%" headers="mcps1.2.3.2.1.3.1.2 ">Virtual Router Redundancy Protocol Version 3 for IPv4 and IPv6</td>

</tr>

</tbody>

</table>
</div>
</div>

</div>

<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="network-layer.html">网络层</a></div>
</div>
</div>

<div class="hrcopyright"><hr size="2"></div><div class="hwcopyright">本资料收集于互联网</div><div class="hwcopyright">2016 &copy</div></body>
</html>